#define LEFT OUT_A
#define CLAW OUT_B
#define RIGHT OUT_C

#define LIGHT_CYL SENSOR_1
#define LIGHT_LINE SENSOR_2
#define TOUCH SENSOR_3

#define LINEHIGHTHRESHOLD 60
#define LINELOWTHRESHOLD 30

void InitSensors()
{
  SetSensor( LIGHT_CYL, SENSOR_LIGHT );
  SetSensor( LIGHT_LINE, SENSOR_LIGHT );
  SetSensor( TOUCH, SENSOR_TOUCH );
}

task main()
{
  InitSensors();
  
  while( 1 )
  {
    until( TOUCH == 1 );
    until( TOUCH == 1 );
    until( TOUCH == 1 );
    until( TOUCH == 1 );
  }
}

sub FollowTheLine(){
     OnFwd(LEFT + RIGHT);
  while ( LIGHT_LINE >= LINELOWTHRESHOLD && LIGHT_LINE <= LINEHIGHTHRESHOLD) ; //do nothing while it's ok
  //not ok anymore
}


sub CorrectTrajectory(){

  if(    LIGHT_LINE < LINELOWTHRESHOLD      ){ //to far to the right, go left
    Off(LEFT);
    until(LIGHT_LINE >= LINELOWTHRESHOLD);
  }else if ( LIGHT_LINE > LINEHIGHTHRESHOLD ) {
    Off(RIGHT);
    until(LIGHT_LINE <= LINEHIGHTHRESHOLD);
  }
  
  
}

task StartFollowTheLine()
{
  //Assume the line is on our right side
  
  //let's find it
  Off (RIGHT);
  OnFwd (LEFT);
  
  until( LIGHT_LINE >= LINELOWTHRESHOLD && LIGHT_LINE <= LINEHIGHTHRESHOLD );//found it
  
  while(1)  FollowTheLine();
  

}
